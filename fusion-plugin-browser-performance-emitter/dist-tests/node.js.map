{"version":3,"file":"node.js","sources":["../src/server.js","../src/__tests__/test.node.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\nimport {UniversalEventsToken} from 'fusion-plugin-universal-events';\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin} from 'fusion-core';\nimport type {BrowserPerfDepsType} from './flow';\n\nconst plugin: FusionPlugin<BrowserPerfDepsType, void> =\n  // $FlowFixMe\n  __NODE__ &&\n  createPlugin({\n    deps: {emitter: UniversalEventsToken},\n    provides: deps => {\n      const emitter = deps.emitter;\n      emitter.on('browser-performance-emitter:stats:browser-only', (e, ctx) => {\n        emitter.emit('browser-performance-emitter:stats', mapPerfEvent(e), ctx);\n      });\n\n      /* Helper Functions */\n      function mapPerfEvent(event) {\n        const {timing, resourceEntries, paintTimes, enhancedMetrics} = event;\n\n        if (enhancedMetrics) {\n          if (!enhancedMetrics.app) {\n            enhancedMetrics.app = {};\n          }\n          enhancedMetrics.app.perfLoggerVersion = require('../package.json').version;\n        }\n\n        const calculatedStats = getCalculatedStats(\n          timing,\n          resourceEntries,\n          paintTimes\n        );\n\n        return {\n          ...event,\n          calculatedStats,\n          timingValues: timing,\n          enhancedMetrics,\n        };\n      }\n\n      function getCalculatedStats(timing, resourceEntries, paintTimes) {\n        let calculated = {};\n        if (!isEmpty(timing)) {\n          calculated = {\n            // time spent following redirects\n            redirection_time: timing.fetchStart - timing.navigationStart,\n            // time from the initial navigation to getting a response from the server\n            time_to_first_byte: timing.responseStart - timing.navigationStart,\n            // time from the initial request to having all blocking assets loaded\n            dom_content_loaded:\n              timing.domContentLoadedEventEnd - timing.fetchStart,\n            // time from initial request to having all assets (blocking and nonblocking) loaded\n            full_page_load: timing.loadEventEnd - timing.fetchStart,\n            // dns lookup time\n            dns: timing.domainLookupEnd - timing.domainLookupStart,\n            // time to open tcp connection\n            tcp_connection_time: timing.connectEnd - timing.connectStart,\n            // time for browser to get back full html response from server\n            browser_request_time: timing.responseEnd - timing.requestStart,\n            // time for browser to receive initial response from server\n            browser_request_first_byte:\n              timing.responseStart - timing.requestStart,\n            // time from receiving first byte to receiving full response\n            browser_request_response_time:\n              timing.responseEnd - timing.responseStart,\n            // time to parse the html response into a DOM tree + load blocking resources\n            dom_interactive_time: timing.domInteractive - timing.responseEnd,\n            // time from having fully parsed html to having all assets loaded\n            total_resource_load_time:\n              timing.loadEventStart - timing.responseEnd,\n            // time from having fully parsed html to having all blocking assets loaded\n            total_blocking_resource_load_time:\n              timing.domContentLoadedEventStart - timing.responseEnd,\n          };\n          if (paintTimes) {\n            // $FlowFixMe\n            calculated.first_paint_time = paintTimes.firstPaint;\n            // $FlowFixMe\n            calculated.first_contentful_paint_time =\n              paintTimes.firstContentfulPaint;\n          }\n        }\n\n        if (!isEmpty(resourceEntries)) {\n          // $FlowFixMe\n          calculated.resources_avg_load_time = {};\n          // all of the values are on the prototype so we need to extract them\n          const resourceLoadTimes = resourceEntries.reduce((memo, entry) => {\n            const type = extractResourceType(entry.name);\n            if (type) {\n              if (!memo[type]) {\n                memo[type] = [];\n              }\n              memo[type].push(entry.duration);\n            }\n            return memo;\n          }, {});\n\n          if (!isEmpty(resourceLoadTimes)) {\n            Object.keys(resourceLoadTimes).forEach(resourceType => {\n              const avgTime = parseInt(\n                mean(resourceLoadTimes[resourceType]),\n                10\n              );\n              // $FlowFixMe\n              calculated.resources_avg_load_time[resourceType] = avgTime;\n            });\n          }\n        }\n\n        return calculated;\n      }\n\n      function isEmpty(item) {\n        // eslint-disable-next-line no-undefined\n        if (item === null || item === undefined) {\n          return true;\n        }\n        if (typeof item === 'object' && Object.keys(item).length === 0) {\n          return true;\n        }\n        if (Array.isArray(item) && item.length === 0) {\n          return true;\n        }\n        return false;\n      }\n\n      function extractResourceType(name) {\n        const type = name.substring(name.lastIndexOf('.') + 1);\n\n        if (type.indexOf('css') === 0) {\n          return 'css';\n        } else if (type.indexOf('js') === 0) {\n          return 'js';\n        } else if (\n          type.indexOf('png') === 0 ||\n          type.indexOf('svg') === 0 ||\n          type.indexOf('jpg') === 0\n        ) {\n          return 'image';\n        }\n        return null;\n      }\n\n      function mean(array) {\n        return (\n          array.reduce((total, element) => {\n            total += element;\n            return total;\n          }, 0) / array.length\n        );\n      }\n    },\n  });\nexport default plugin;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport test from 'tape-cup';\nimport MockEmitter from 'events';\n\nimport App, {createPlugin} from 'fusion-core';\nimport {UniversalEventsToken} from 'fusion-plugin-universal-events';\nimport {getSimulator} from 'fusion-test-utils';\n\nimport type {FusionPlugin} from 'fusion-core';\n\nimport BrowserPerformanceEmitterPlugin from '../server';\n\n/* Mock Results */\nconst mockTiming = {\n  connectEnd: 1467935411926,\n  connectStart: 1467935411926,\n  domComplete: 1467935412992,\n  domContentLoadedEventEnd: 1467935412858,\n  domContentLoadedEventStart: 1467935412729,\n  domInteractive: 1467935412729,\n  domLoading: 1467935412016,\n  domainLookupEnd: 1467935411926,\n  domainLookupStart: 1467935411926,\n  fetchStart: 1467935411926,\n  loadEventEnd: 1467935412992,\n  loadEventStart: 1467935412992,\n  navigationStart: 1467935411926,\n  redirectEnd: 0,\n  redirectStart: 0,\n  requestStart: 1467935411933,\n  responseEnd: 1467935412008,\n  responseStart: 1467935412007,\n  secureConnectionStart: 0,\n  unloadEventEnd: 1467935412009,\n  unloadEventStart: 1467935412009,\n};\n\nconst mockResourceEntries = [\n  {\n    initiatorType: 'link',\n    name: 'http://localhost:5663/trips-viewer/stylesheets/main.css',\n    entryType: 'resource',\n    startTime: 132.92000000000002,\n    duration: 4.435000000000002,\n  },\n  {\n    initiatorType: 'link',\n    name:\n      'https://d1a3f4spazzrp4.cloudfront.net/uber-icons/3.13.0/uber-icons.css',\n    entryType: 'resource',\n    startTime: 132.995,\n    duration: 77.06,\n  },\n  {\n    initiatorType: 'link',\n    name:\n      'https://d1a3f4spazzrp4.cloudfront.net/uber-fonts/4.0.0/superfine.css',\n    entryType: 'resource',\n    startTime: 133.06500000000003,\n    duration: 83.655,\n  },\n  {\n    initiatorType: 'script',\n    name: 'http://localhost:5663/trips-viewer/javascripts/main.js',\n    entryType: 'resource',\n    startTime: 133.355,\n    duration: 16.785000000000025,\n  },\n  {\n    initiatorType: 'link',\n    duration: 155.39500000000007,\n    entryType: 'resource',\n    name:\n      'https://image.et.uber.com/lib/fe8c12737c64037b71/m/1/us_144x144_teal_community.png',\n    startTime: 150.095,\n  },\n  {\n    initiatorType: 'link',\n    name:\n      'http://localhost:5663/trips-viewer/stylesheets/main.css?someVersion=foo',\n    entryType: 'resource',\n    startTime: 132.92000000000002,\n    duration: 4.435000000000002,\n  },\n  {\n    initiatorType: 'script',\n    duration: 4.545000000000073,\n    entryType: 'resource',\n    name:\n      'https://www.google-analytics.com/collect?v=1&_v=j41&a=2108927418&t=pageview&_s=1&dl=https%3A%2F%2Fweb-platform.uberinternal.com%2Ftrips-viewer%2Fuser&dr=https%3A%2F%2Fapp.onelogin.com%2Ftrust%2Fsaml2%2Fhttp-post%2Fsso%2F358421%3FSAMLRequest%3DnVPBjpswEP0V5DsQSLLLWiESzapqpG2LEtprNbGHXUvGpvbQpH9fQ5Iqh24OPdnMPN578xhWHjrd82qgN7PDnwN6ik6dNp5PjZINznALXnluoEPPSfB99fmF58mM986SFVazqL7cPigjlXm9%252F9rhDPL8U9PUcf1137DoOzqvrClZALBo6%252F2AW%252BMJDIXSLHuIZ4s4nzXZI5%252FnfDlCnkuWLQtY5nMBD2KxKB4zODy1oijmT60Mh0QWVd6jo0C8scYPHbo9ul9K4LfdS8neiHrP0%252FSIh7jXQK11XTIc0ClD6AzoRNgutUpCSCcd8%252FghzjRsvRof%252BeTT3QR2f3C4umHrqzb0fWINavuqzCQ3sqQdEkggSOfLYpFnq%252FRG7Szd8y%252BBfvtcW63E76jS2h43DoGwZOSGMPrHMA3Q%252B4ayJJsqSsbtBOXYgdKVlA69Z%252BlV57IVKKcdCTkSnija2K4Hp%252Fz4yfAEgq6R3KI2Oky8w%252FZ%252FAroLE1yM1KFch%252BNonRwXEEVw2TgwvreOLqH9y8%252F63Htntr%252Fd259i%252FQc%253D%26RelayState%3D%252Ftrips-viewer%252F&dp=trips-viewer&ul=en-us&de=UTF-8&dt=User%20Info&sd=24-bit&sr=2560x1440&vp=1180x818&je=0&fl=21.0%20r0&_u=AACAAEABI~&jid=&cid=1657993685.1456163541&tid=UA-7157694-45&z=2009568991',\n    startTime: 1700.3400000000001,\n  },\n];\n\nconst mockEvent = {\n  timing: mockTiming,\n  resourceEntries: mockResourceEntries,\n  firstPaint: null,\n  tags: null,\n};\n\n/* Fixture */\nfunction createTestFixture() {\n  const app = new App('content', el => el);\n  app.register(BrowserPerformanceEmitterPlugin);\n  return app;\n}\n\n/* Tests */\ntest('Correct metrics are emitted', t => {\n  const mockEmitter = new MockEmitter();\n  const mockEmitterPlugin: FusionPlugin<any, any> = createPlugin({\n    provides: () => mockEmitter,\n  });\n\n  const app = createTestFixture();\n  app.register(UniversalEventsToken, mockEmitterPlugin);\n\n  // Process emits\n  t.plan(14);\n  const handlePerfEvent = function(event) {\n    const calculatedStats = event.calculatedStats;\n    t.notEqual(calculatedStats, undefined, 'calculatedStates are defined');\n\n    const redirectionTimeArgs = calculatedStats.redirection_time;\n    const timeToFirstByteArgs = calculatedStats.time_to_first_byte;\n    const domContentLoadedArgs = calculatedStats.dom_content_loaded;\n    const fullPageLoadArgs = calculatedStats.full_page_load;\n    const dnsArgs = calculatedStats.dns;\n    const tcpConnectionTimeArgs = calculatedStats.tcp_connection_time;\n    const browserRequestTimeArgs = calculatedStats.browser_request_time;\n    const browserRequestFirstByteArgs =\n      calculatedStats.browser_request_first_byte;\n    const browserRequestResponseTimeArgs =\n      calculatedStats.browser_request_response_time;\n    const domInteractiveTimeArgs = calculatedStats.dom_interactive_time;\n    const totalResourceLoadTimeArgs = calculatedStats.total_resource_load_time;\n    const totalBlockingResourceLoadTimeArgs =\n      calculatedStats.total_blocking_resource_load_time;\n    const resourcesAvgLoadTime = calculatedStats.resources_avg_load_time;\n\n    t.equal(redirectionTimeArgs, 0, 'redirection_time');\n    t.equal(timeToFirstByteArgs, 81, 'time_to_first_byte');\n    t.equal(domContentLoadedArgs, 932, 'dom_content_loaded');\n    t.equal(fullPageLoadArgs, 1066, 'full_page_load');\n    t.equal(dnsArgs, 0, 'dns');\n\n    t.equal(tcpConnectionTimeArgs, 0, 'logs the tcp_connection_time');\n    t.equal(browserRequestTimeArgs, 75, 'logs the browser_request_time');\n    t.equal(\n      browserRequestFirstByteArgs,\n      74,\n      'logs the browser_request_first_byte'\n    );\n    t.equal(\n      browserRequestResponseTimeArgs,\n      1,\n      'logs the browser_request_response_time'\n    );\n    t.equal(domInteractiveTimeArgs, 721, 'logs the dom_interactive_time');\n    t.equal(\n      totalResourceLoadTimeArgs,\n      984,\n      'logs the total_resource_load_time'\n    );\n    t.equal(\n      totalBlockingResourceLoadTimeArgs,\n      721,\n      'logs the total_blocking_resource_load_time'\n    );\n    t.deepLooseEqual(\n      resourcesAvgLoadTime,\n      {css: 42, image: 155, js: 16},\n      'logs the total_blocking_resource_load_time'\n    );\n  };\n\n  /* Simulator */\n  getSimulator(\n    app,\n    createPlugin({\n      provides: () => {\n        mockEmitter.on('browser-performance-emitter:stats', handlePerfEvent);\n        mockEmitter.emit(\n          'browser-performance-emitter:stats:browser-only',\n          mockEvent\n        );\n      },\n    })\n  );\n\n  t.end();\n});\n\ntest('Re-emitting events from browser to server correctly', t => {\n  const mockEmitter = new MockEmitter();\n  const mockEmitterPlugin: FusionPlugin<any, any> = createPlugin({\n    provides: () => mockEmitter,\n  });\n\n  const app = createTestFixture();\n  app.register(UniversalEventsToken, mockEmitterPlugin);\n\n  const mockEvent = {foo: {bar: 99}};\n\n  t.plan(1);\n\n  /* Simulator */\n  getSimulator(\n    app,\n    createPlugin({\n      provides: () => {\n        mockEmitter.on('browser-performance-emitter:stats', e => {\n          t.deepEqual(\n            e.foo,\n            mockEvent.foo,\n            'Browser event payload is inherited'\n          );\n        });\n        mockEmitter.emit(\n          'browser-performance-emitter:stats:browser-only',\n          mockEvent\n        );\n      },\n    })\n  );\n\n  t.end();\n});\n"],"names":["plugin","createPlugin","deps","emitter","UniversalEventsToken","provides","on","e","ctx","emit","mapPerfEvent","event","timing","resourceEntries","paintTimes","enhancedMetrics","app","perfLoggerVersion","require","version","calculatedStats","getCalculatedStats","timingValues","calculated","isEmpty","redirection_time","fetchStart","navigationStart","time_to_first_byte","responseStart","dom_content_loaded","domContentLoadedEventEnd","full_page_load","loadEventEnd","dns","domainLookupEnd","domainLookupStart","tcp_connection_time","connectEnd","connectStart","browser_request_time","responseEnd","requestStart","browser_request_first_byte","browser_request_response_time","dom_interactive_time","domInteractive","total_resource_load_time","loadEventStart","total_blocking_resource_load_time","domContentLoadedEventStart","first_paint_time","firstPaint","first_contentful_paint_time","firstContentfulPaint","resources_avg_load_time","resourceLoadTimes","reduce","memo","entry","type","extractResourceType","name","push","duration","Object","keys","forEach","resourceType","avgTime","parseInt","mean","item","undefined","length","Array","isArray","substring","lastIndexOf","indexOf","array","total","element","mockTiming","domComplete","domLoading","redirectEnd","redirectStart","secureConnectionStart","unloadEventEnd","unloadEventStart","mockResourceEntries","initiatorType","entryType","startTime","mockEvent","tags","createTestFixture","App","el","register","BrowserPerformanceEmitterPlugin","test","t","mockEmitter","MockEmitter","mockEmitterPlugin","plan","handlePerfEvent","notEqual","redirectionTimeArgs","timeToFirstByteArgs","domContentLoadedArgs","fullPageLoadArgs","dnsArgs","tcpConnectionTimeArgs","browserRequestTimeArgs","browserRequestFirstByteArgs","browserRequestResponseTimeArgs","domInteractiveTimeArgs","totalResourceLoadTimeArgs","totalBlockingResourceLoadTimeArgs","resourcesAvgLoadTime","equal","deepLooseEqual","css","image","js","getSimulator","end","foo","bar","deepEqual"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}
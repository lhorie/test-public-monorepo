{"version":3,"file":"node.js","sources":["../src/emitter.js","../src/__tests__/test.js","../src/server.js","../src/storage/in-memory.js","../src/storage/local-storage.js","../src/storage/index.js","../src/browser.js","../src/index.js","../src/__tests__/test.node.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Context} from 'fusion-core';\n\nimport type {IEmitter} from './types.js';\n\nconst globalEventType = '*';\nexport default class UniversalEmitter implements IEmitter {\n  handlers: any;\n  mappers: any;\n\n  constructor() {\n    this.handlers = {};\n    this.mappers = {};\n  }\n  map(...args: *): * {\n    const {type, callback} = getArgs(args);\n    if (!this.mappers[type]) this.mappers[type] = [];\n    this.mappers[type].push(callback);\n  }\n  on(...args: *): * {\n    const {type, callback} = getArgs(args);\n    if (!this.handlers[type]) this.handlers[type] = [];\n    this.handlers[type].push(callback);\n  }\n  off(...args: *): * {\n    const {type, callback} = getArgs(args);\n    const index = this.handlers[type].indexOf(callback);\n    if (index > -1) this.handlers[type].splice(index, 1);\n  }\n  mapEvent(type: mixed, payload: mixed, ctx?: Context): mixed {\n    const globalMappers = this.mappers[globalEventType] || [];\n    const mappers = (this.mappers[type] || []).concat(globalMappers);\n    return mappers.reduce((payload, mapper) => {\n      return mapper(payload, ctx, type);\n    }, payload);\n  }\n  handleEvent(type: mixed, payload: mixed, ctx?: Context): void {\n    const globalHandlers = this.handlers[globalEventType] || [];\n    const handlers = (this.handlers[type] || []).concat(globalHandlers);\n    handlers.forEach(handler => handler(payload, ctx, type));\n  }\n\n  /* eslint-disable-next-line  no-unused-vars */\n  from(ctx: Context) {\n    throw new Error('Not implemented.');\n  }\n  /* eslint-disable-next-line  no-unused-vars */\n  emit(type: mixed, payload: mixed, ctx?: Context) {\n    // throw new Error('Not implemented.');\n  }\n  /* eslint-disable-next-line  no-unused-vars */\n  setFrequency(frequency: number) {\n    throw new Error('Not implemented.');\n  }\n  teardown() {\n    throw new Error('Not implemented.');\n  }\n  flush() {\n    throw new Error('Not implemented.');\n  }\n}\n\nfunction validateHandler(handler) {\n  if (typeof handler !== 'function')\n    throw new TypeError('handler must be a function');\n}\n\nfunction getArgs(args) {\n  const type = typeof args[0] === 'string' ? args[0] : globalEventType;\n  const callback = args[1] || args[0];\n  validateHandler(callback);\n  return {type, callback};\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport test from 'tape-cup';\n\nimport EventEmitter from '../emitter.js';\nimport type {IEmitter} from '../types.js';\n\ntest('Base EventEmitter on/off', t => {\n  t.ok(typeof EventEmitter === 'function', 'exported correctly');\n  const events: IEmitter = new EventEmitter();\n  let eventHandlerCount = 0;\n  function handleEvent(event) {\n    eventHandlerCount++;\n    t.equal(event, 'test-data', 'correct payload passed to handler');\n  }\n  events.on('some-event', handleEvent);\n  events.handleEvent('other-event', 'other-data');\n  events.handleEvent('some-event', 'test-data');\n  t.equal(eventHandlerCount, 1, 'calls handler one time');\n  events.off('some-event', handleEvent);\n  events.handleEvent('some-event', 'test-data');\n  t.equal(eventHandlerCount, 1, 'does not call the handler after removal');\n  t.end();\n});\n\ntest('Base EventEmitter mappers', t => {\n  const events: IEmitter = new EventEmitter();\n  let eventHandlerCount = 0;\n  let mapCount = 0;\n  events.on('test', event => {\n    eventHandlerCount++;\n    t.equal(event.a, true, 'correct payload passed to handler');\n    t.equal(event.b, true, 'correct payload passed to handler');\n  });\n  events.map('test', event => {\n    mapCount++;\n    return Object.assign(event, {a: true});\n  });\n  const mappedPayload = events.mapEvent('test', {b: true});\n  events.handleEvent('test', mappedPayload);\n  t.equal(eventHandlerCount, 1, 'calls handler one time');\n  t.equal(mapCount, 1, 'calls mapper one time');\n  t.end();\n});\n\ntest('Base EventEmitter * mappers', t => {\n  const events: IEmitter = new EventEmitter();\n  events.map('*', payload => {\n    return {...payload, a: true};\n  });\n  events.map('test', payload => {\n    return {...payload, b: true};\n  });\n  events.on('test', payload => {\n    t.deepLooseEqual(payload, {\n      a: true,\n      b: true,\n      c: true,\n    });\n    t.end();\n  });\n  const mappedPayload = events.mapEvent('test', {c: true});\n  events.handleEvent('test', mappedPayload);\n});\n\ntest('Base EventEmitter implicit * mappers', t => {\n  const events: IEmitter = new EventEmitter();\n  events.map(payload => {\n    return {...payload, a: true};\n  });\n  events.map('test', payload => {\n    return {...payload, b: true};\n  });\n  events.on('test', payload => {\n    t.deepLooseEqual(payload, {\n      a: true,\n      b: true,\n      c: true,\n    });\n    t.end();\n  });\n  const mappedPayload = events.mapEvent('test', {c: true});\n  events.handleEvent('test', mappedPayload);\n});\n\ntest('Base EventEmitter * handlers', t => {\n  const events: IEmitter = new EventEmitter();\n  let calledGlobal = false;\n  let calledNormal = false;\n  events.on((payload, ctx, type) => {\n    t.deepLooseEqual(payload, {\n      c: true,\n    });\n    t.equal(type, 'test', 'correct type passed to handler');\n    calledGlobal = true;\n  });\n\n  events.on('test', payload => {\n    t.deepLooseEqual(payload, {\n      c: true,\n    });\n    calledNormal = true;\n  });\n  events.handleEvent('test', {c: true});\n  t.ok(calledGlobal);\n  t.ok(calledNormal);\n  t.end();\n});\n\ntest('Base EventEmitter implicit * handlers', t => {\n  const events: IEmitter = new EventEmitter();\n  let calledGlobal = false;\n  let calledNormal = false;\n  events.on('*', (payload, ctx, type) => {\n    t.deepLooseEqual(payload, {\n      c: true,\n    });\n    t.equal(type, 'test', 'correct type passed to handler');\n    calledGlobal = true;\n  });\n\n  events.on('test', payload => {\n    t.deepLooseEqual(payload, {\n      c: true,\n    });\n    calledNormal = true;\n  });\n  events.handleEvent('test', {c: true});\n  t.ok(calledGlobal);\n  t.ok(calledNormal);\n  t.end();\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport {memoize, createPlugin} from 'fusion-core';\nimport type {FusionPlugin, Context} from 'fusion-core';\n\nimport Emitter from './emitter.js';\nimport type {\n  IEmitter,\n  UniversalEventsPluginDepsType as DepsType,\n} from './types.js';\n\nexport class GlobalEmitter extends Emitter {\n  from: any;\n  ctx: any;\n\n  constructor() {\n    super();\n    this.from = memoize(ctx => {\n      return new ScopedEmitter(ctx, this);\n    });\n  }\n  emit(type: mixed, payload: mixed, ctx?: Context): void {\n    payload = super.mapEvent(type, payload, this.ctx);\n    super.handleEvent(type, payload, ctx);\n  }\n  // mirror browser api\n  setFrequency() {}\n  teardown() {}\n}\n\nclass ScopedEmitter extends Emitter {\n  ctx: any;\n  parent: any;\n  batch: any;\n  flushed: any;\n\n  constructor(ctx, parent) {\n    super();\n    this.ctx = ctx;\n    this.parent = parent;\n    this.batch = [];\n    this.flushed = false;\n  }\n  emit(type, payload) {\n    // this logic exists to manage ensuring we send events after the batch\n    if (this.flushed) {\n      this.handleBatchedEvent({type, payload});\n    } else {\n      this.batch.push({type, payload});\n    }\n  }\n  handleBatchedEvent({type, payload}) {\n    payload = super.mapEvent(type, payload, this.ctx);\n    payload = this.parent.mapEvent(type, payload, this.ctx);\n    super.handleEvent(type, payload, this.ctx);\n    this.parent.handleEvent(type, payload, this.ctx);\n  }\n  flush() {\n    for (let index = 0; index < this.batch.length; index++) {\n      this.handleBatchedEvent(this.batch[index]);\n    }\n    this.batch = [];\n    this.flushed = true;\n  }\n  // mirror browser api\n  setFrequency() {}\n  teardown() {}\n}\n\nconst plugin =\n  __NODE__ &&\n  createPlugin({\n    provides: () => new GlobalEmitter(),\n    middleware: (deps, globalEmitter) => {\n      const bodyParser = require('koa-bodyparser');\n      const parseBody = bodyParser();\n      return async function universalEventsMiddleware(ctx, next) {\n        const emitter = globalEmitter.from(ctx);\n        if (ctx.method === 'POST' && ctx.path === '/_events') {\n          await parseBody(ctx, async () => {});\n          // $FlowFixMe\n          const {items} = ctx.request.body;\n          if (items) {\n            for (let index = 0; index < items.length; index++) {\n              const {type, payload} = items[index];\n              emitter.emit(type, payload);\n            }\n            ctx.status = 200;\n          } else {\n            ctx.status = 400;\n          }\n        }\n        // awaiting next before registering `then` on ctx.timing.end to try and get as much as possible\n        // into the event batch flush.\n        await next();\n        ctx.timing.end.then(() => {\n          emitter.flush();\n        });\n      };\n    },\n  });\n\nexport default ((plugin: any): FusionPlugin<DepsType, IEmitter>);\n","// @flow\n\nimport type {BatchStorage, BatchType} from '../types';\n\nclass InMemoryBatchStorage implements BatchStorage {\n  data = [];\n\n  add = (...toBeAdded: BatchType[]) => {\n    this.data.push(...toBeAdded);\n  };\n\n  addToStart = (...toBeAdded: BatchType[]) => {\n    this.data.unshift(...toBeAdded);\n  };\n\n  getAndClear = () => {\n    const events = this.data;\n    this.data = [];\n    return events;\n  };\n}\n\nexport const inMemoryBatchStorage = new InMemoryBatchStorage();\n","// @flow\n/* global window */\n\nimport type {BatchType, BatchStorage} from '../types';\nimport {inMemoryBatchStorage} from './in-memory';\n\nconst storageKey = 'fusion-events';\n\nconst get = () => {\n  try {\n    const events = JSON.parse(window.localStorage.getItem(storageKey));\n    return Array.isArray(events) ? events : [];\n  } catch (e) {\n    return [];\n  }\n};\n\nconst clear = () => {\n  try {\n    window.localStorage.removeItem(storageKey);\n  } catch (e) {\n    // do nothing\n  }\n};\n\nconst set = (events: BatchType[]) => {\n  try {\n    window.localStorage.setItem(storageKey, JSON.stringify(events));\n  } catch (e) {\n    // storage might be full, do nothing\n  }\n};\n\nclass LocalBatchStorage implements BatchStorage {\n  add = (...toBeAdded: BatchType[]) => {\n    set(toBeAdded.concat(get()));\n  };\n\n  addToStart = (...toBeAdded: BatchType[]) => {\n    set(toBeAdded.concat(get()));\n  };\n\n  getAndClear = () => {\n    const events = get();\n    clear();\n    return events;\n  };\n}\n\nlet isLocalStorageWritable = true;\n\ntry {\n  window.localStorage.setItem('test', 'test');\n  window.localStorage.removeItem('test');\n} catch (e) {\n  // if set/remove item fails localStorage is not writable\n  // fallback to in-memory storage\n  isLocalStorageWritable = false;\n}\n\nexport const localBatchStorage = isLocalStorageWritable\n  ? new LocalBatchStorage()\n  : inMemoryBatchStorage;\n","// @flow\n\nimport type {Token} from 'fusion-core';\nimport type {BatchStorage} from '../types';\nimport {createToken} from 'fusion-core';\n\nexport const UniversalEventsBatchStorageToken: Token<BatchStorage> = createToken(\n  'UniversalEventsBatchStorageToken'\n);\n\nexport {inMemoryBatchStorage} from './in-memory.js';\nexport {localBatchStorage} from './local-storage.js';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin} from 'fusion-core';\nimport {FetchToken} from 'fusion-tokens';\nimport type {Fetch} from 'fusion-tokens';\nimport Emitter from './emitter.js';\nimport type {\n  IEmitter,\n  UniversalEventsPluginDepsType as DepsType,\n  BatchStorage,\n} from './types.js';\nimport {\n  UniversalEventsBatchStorageToken,\n  localBatchStorage,\n} from './storage/index.js';\n\nexport class UniversalEmitter extends Emitter {\n  flush: any;\n  fetch: any;\n  interval: any;\n  storage: BatchStorage;\n\n  constructor(\n    fetch: Fetch,\n    storage: BatchStorage,\n    interval?: number = 5000\n  ): void {\n    super();\n    //privates\n    this.storage = storage;\n    this.flush = this.flushInternal.bind(this);\n    this.fetch = fetch;\n    this.setFrequency(interval);\n    window.addEventListener('visibilitychange', this.flushBeforeTerminated);\n  }\n  setFrequency(frequency: number): void {\n    window.clearInterval(this.interval);\n    this.interval = setInterval(this.flush, frequency);\n  }\n  emit(type: mixed, payload: mixed): void {\n    payload = super.mapEvent(type, payload);\n    super.handleEvent(type, payload);\n    this.storage.add({type, payload});\n  }\n  // match server api\n  from(): UniversalEmitter {\n    return this;\n  }\n  flushBeforeTerminated = () =>\n    document.visibilityState === 'hidden' && this.flushInternal();\n  async flushInternal(): Promise<void> {\n    const items = this.storage.getAndClear();\n    if (items.length === 0) return;\n\n    try {\n      const res = await this.fetch('/_events', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({items}),\n      });\n\n      if (!res.ok) {\n        // sending failed so put the logs back into storage\n        this.storage.addToStart(...items);\n      }\n    } catch (e) {\n      // sending failed so put the logs back into storage\n      this.storage.addToStart(...items);\n    }\n  }\n  teardown(): void {\n    window.removeEventListener('visibilitychange', this.flushBeforeTerminated);\n    clearInterval(this.interval);\n    this.interval = null;\n  }\n}\n\nconst plugin =\n  __BROWSER__ &&\n  createPlugin({\n    deps: {\n      fetch: FetchToken,\n      storage: UniversalEventsBatchStorageToken.optional,\n    },\n    provides: ({fetch, storage}) => {\n      return new UniversalEmitter(fetch, storage || localBatchStorage);\n    },\n    cleanup: async emitter => {\n      return emitter.teardown();\n    },\n  });\n\nexport default ((plugin: any): FusionPlugin<DepsType, IEmitter>);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {createToken} from 'fusion-core';\nimport type {FusionPlugin, Token} from 'fusion-core';\n\nimport ServerEvents from './server.js';\nimport BrowserEvents from './browser.js';\nimport type {\n  IEmitter,\n  UniversalEventsPluginDepsType as DepsType,\n} from './types.js';\n\nconst UniversalEventsPlugin = __BROWSER__ ? BrowserEvents : ServerEvents;\n\n// eslint-disable-next-line prettier/prettier\nexport default ((UniversalEventsPlugin: any): FusionPlugin<DepsType, IEmitter>);\n\nexport const UniversalEventsToken: Token<IEmitter> = createToken(\n  'UniversalEventsToken'\n);\n\nexport * from './storage/index.js';\n\nexport type UniversalEventsDepsType = DepsType;\nexport type UniversalEventsType = IEmitter;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport test from 'tape-cup';\nimport App, {createPlugin, compose} from 'fusion-core';\nimport {getSimulator} from 'fusion-test-utils';\n\nimport UniversalEventsPlugin, {GlobalEmitter} from '../server.js';\nimport {UniversalEventsToken} from '../index';\nimport type {IEmitter} from '../types.js';\n\ntest('Instantiation', t => {\n  const a = {\n    memoized: new Map(),\n  };\n  const b = {\n    memoized: new Map(),\n  };\n  const Emitter: IEmitter = new GlobalEmitter();\n  // $FlowFixMe\n  t.notEqual(Emitter.from(a), Emitter.from(b));\n  // $FlowFixMe\n  t.notEqual(Emitter.from(a), Emitter);\n  t.end();\n});\n\ntest('Server EventEmitter - events from browser', async t => {\n  let called = false;\n  let globalCalled = false;\n  const mockCtx = {\n    headers: {},\n    method: 'POST',\n    path: '/_events',\n    request: {\n      body: {\n        items: [{type: 'a', payload: {x: 1}}],\n      },\n    },\n    timing: {\n      end: Promise.resolve(5),\n    },\n  };\n  const app = new App('el', el => el);\n  app.register(UniversalEventsToken, UniversalEventsPlugin);\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    events.on('a', ({x}, ctx) => {\n      t.equals(x, 1, 'payload is correct');\n      t.ok(ctx);\n      globalCalled = true;\n    });\n    return (ctx, next) => {\n      const ctxEmitter = events.from(ctx);\n      ctxEmitter.on('a', ({x}, ctx) => {\n        t.equals(x, 1, 'payload is correct');\n        t.ok(ctx);\n        called = true;\n      });\n      return next();\n    };\n  });\n  app.resolve();\n  try {\n    // $FlowFixMe\n    await compose(app.plugins)(mockCtx, () => Promise.resolve());\n    t.ok(called, 'called');\n    t.ok(globalCalled, 'called global handler');\n  } catch (e) {\n    t.ifErr(e);\n  }\n  t.end();\n});\n\ntest('Server EventEmitter - events with ctx', async t => {\n  let globalCalled = false;\n  const mockCtx = {mock: true};\n  const app = new App('el', el => el);\n  app.register(UniversalEventsToken, UniversalEventsPlugin);\n  app.register(\n    createPlugin({\n      deps: {events: UniversalEventsToken},\n      provides: ({events}) => {\n        events.on('b', ({x}, ctx) => {\n          t.equals(x, 1, 'payload is correct');\n          t.equals(ctx, mockCtx, 'ctx is correct');\n          globalCalled = true;\n        });\n        // $FlowFixMe\n        events.emit('b', {x: 1}, mockCtx);\n        t.ok(globalCalled, 'called global handler');\n        t.end();\n      },\n    })\n  );\n  app.resolve();\n});\n\ntest('Server EventEmitter - mapping', async t => {\n  let called = false;\n  let globalCalled = false;\n  const mockCtx = {\n    headers: {},\n    method: 'POST',\n    path: '/lol',\n    timing: {\n      end: Promise.resolve(5),\n    },\n  };\n  const app = new App('fake-element', el => el);\n  app.register(UniversalEventsToken, UniversalEventsPlugin);\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    events.on('a', (payload, c) => {\n      t.equal(c, mockCtx, 'ctx is passed to global handlers');\n      t.deepLooseEqual(\n        payload,\n        {x: true, b: true, global: true},\n        'payload is correct for global'\n      );\n      globalCalled = true;\n    });\n    events.map('a', (payload, c) => {\n      t.equal(c, mockCtx, 'ctx is passed to global mappers');\n      return {...payload, global: true};\n    });\n    return (ctx, next) => {\n      const emitter = events.from(ctx);\n      emitter.on('a', (payload, c) => {\n        t.equal(c, ctx, 'ctx is passed to scoped handlers');\n        t.deepLooseEqual(\n          payload,\n          {x: true, b: true, global: true},\n          'payload is correct'\n        );\n        called = true;\n      });\n      emitter.map('a', (payload, c) => {\n        t.equal(c, ctx, 'ctx is passed to scoped mappers');\n        return {...payload, b: true};\n      });\n      emitter.emit('a', {x: 1});\n      return next();\n    };\n  });\n  app.resolve();\n  try {\n    // $FlowFixMe\n    await compose(app.plugins)(mockCtx, () => Promise.resolve());\n    t.ok(called, 'called');\n    t.ok(globalCalled, 'called global handler');\n  } catch (e) {\n    t.ifErr(e);\n  }\n  t.end();\n});\n\ntest('Server EventEmitter batching', async t => {\n  const app = new App('fake-element', el => el);\n  const flags = {\n    preawait: false,\n    postawait: false,\n    postend: false,\n    timeout: false,\n  };\n  app.register(UniversalEventsToken, UniversalEventsPlugin);\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    return async (ctx, next) => {\n      const emitter = events.from(ctx);\n      emitter.on('test-pre-await', ({x}) => {\n        t.equals(x, 1, 'payload is correct');\n        flags.preawait = true;\n      });\n      emitter.emit('test-pre-await', {x: 1});\n      t.notOk(flags.preawait, 'batches pre await next events');\n      // $FlowFixMe\n      t.notOk(emitter.flushed, 'waits to flush');\n      return next();\n    };\n  });\n\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    return async (ctx, next) => {\n      const emitter = events.from(ctx);\n      emitter.on('test-post-await', ({x, lol}) => {\n        t.equals(x, 1, 'payload is correct');\n        t.ok(lol, 'runs mappers');\n        flags.postawait = true;\n      });\n      await next();\n      emitter.emit('test-post-await', {x: 1});\n      emitter.map(payload => {\n        return {\n          ...payload,\n          lol: true,\n        };\n      });\n      // $FlowFixMe\n      t.notOk(emitter.flushed, 'waits to flush');\n      t.notOk(flags.postawait, 'batches post await next events');\n    };\n  });\n\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    return async (ctx, next) => {\n      const emitter = events.from(ctx);\n      emitter.on('test-post-end', ({x, lol}) => {\n        t.equals(x, 1, 'payload is correct');\n        t.ok(lol, 'runs mappers');\n        flags.postend = true;\n      });\n      ctx.timing.end.then(() => {\n        // $FlowFixMe\n        t.notOk(emitter.flushed, 'waits to flush');\n        emitter.emit('test-post-end', {x: 1});\n        t.notOk(flags.postend, 'batches post-end events');\n      });\n      return next();\n    };\n  });\n\n  app.middleware({events: UniversalEventsToken}, ({events}) => {\n    return async (ctx, next) => {\n      const emitter = events.from(ctx);\n      emitter.on('test-timeout', ({x, lol}) => {\n        t.equals(x, 1, 'payload is correct');\n        t.ok(lol, 'runs mappers');\n        flags.timeout = true;\n      });\n      setTimeout(() => {\n        // $FlowFixMe\n        t.ok(emitter.flushed, 'has flushed events');\n        emitter.emit('test-timeout', {x: 1});\n        t.ok(flags.timeout, 'emits events immediately after flushing');\n      }, 100);\n      return next();\n    };\n  });\n  const simulator = getSimulator(app);\n  await simulator.request('/lol', {method: 'POST'});\n\n  setTimeout(() => {\n    t.ok(flags.preawait, 'flushes batch from pre-await emitted events');\n    t.ok(flags.postawait, 'flushes batch from post-await emitted events');\n    t.ok(flags.postend, 'flushes batch from post-end emitted events');\n    t.ok(flags.timeout, 'supports emitting events after batch has flushed');\n    t.end();\n  }, 150);\n});\n"],"names":["globalEventType","UniversalEmitter","constructor","handlers","mappers","map","args","type","callback","getArgs","push","on","off","index","indexOf","splice","mapEvent","payload","ctx","globalMappers","concat","reduce","mapper","handleEvent","globalHandlers","forEach","handler","from","Error","emit","setFrequency","frequency","teardown","flush","validateHandler","TypeError","test","t","ok","EventEmitter","events","eventHandlerCount","event","equal","end","mapCount","a","b","Object","assign","mappedPayload","deepLooseEqual","c","calledGlobal","calledNormal","GlobalEmitter","Emitter","memoize","ScopedEmitter","parent","batch","flushed","handleBatchedEvent","length","plugin","createPlugin","provides","middleware","deps","globalEmitter","bodyParser","require","parseBody","universalEventsMiddleware","next","emitter","method","path","items","request","body","status","timing","then","InMemoryBatchStorage","data","add","toBeAdded","addToStart","unshift","getAndClear","inMemoryBatchStorage","storageKey","get","JSON","parse","window","localStorage","getItem","Array","isArray","e","clear","removeItem","set","setItem","stringify","LocalBatchStorage","isLocalStorageWritable","localBatchStorage","UniversalEventsBatchStorageToken","createToken","fetch","storage","interval","flushBeforeTerminated","document","visibilityState","flushInternal","bind","addEventListener","clearInterval","setInterval","res","headers","removeEventListener","FetchToken","optional","cleanup","UniversalEventsPlugin","ServerEvents","UniversalEventsToken","memoized","Map","notEqual","called","globalCalled","mockCtx","x","Promise","resolve","app","App","el","register","equals","ctxEmitter","compose","plugins","ifErr","mock","global","flags","preawait","postawait","postend","timeout","notOk","lol","setTimeout","simulator","getSimulator"],"mappings":"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"}
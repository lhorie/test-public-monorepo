{"version":3,"file":"node.js","sources":["../src/tokens.js","../src/loader.js","../src/node.js","../src/browser.js","../src/index.js","../src/__tests__/index.node.js","../src/__tests__/loader.node.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {createToken} from 'fusion-core';\nimport type {Token} from 'fusion-core';\n\nimport type {I18nLoaderType} from './loader.js';\n\nexport const I18nLoaderToken: Token<I18nLoaderType> = createToken(\n  'I18nLoaderToken'\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {Locale, Locales} from 'locale';\nimport fs from 'fs';\nimport path from 'path';\n\nimport {memoize} from 'fusion-core';\nimport type {Context} from 'fusion-core';\n\nimport type {TranslationsObjectType} from './types.js';\n\nexport type I18nLoaderType = {\n  from: (\n    ctx: Context\n  ) => {locale: string | Locale, translations: TranslationsObjectType},\n};\nexport type LocaleResolverType = (ctx: Context) => string;\nexport type LoaderFactoryType = (\n  resolveLocales?: LocaleResolverType\n) => I18nLoaderType;\n\nconst defaultResolveLocales: LocaleResolverType = ctx =>\n  ctx.headers['accept-language'];\n\nconst loader: LoaderFactoryType = (resolveLocales = defaultResolveLocales) => {\n  const readDir = root => {\n    try {\n      return fs.readdirSync(root);\n    } catch (e) {\n      return [];\n    }\n  };\n  const root = './translations';\n  const locales = readDir(root)\n    .filter(p => p.match(/json$/))\n    .map(p => p.replace(/\\.json$/, ''));\n  const data = locales.reduce((memo, locale) => {\n    const parsedLocale = new Locale(locale);\n    memo[parsedLocale.normalized] = JSON.parse(\n      fs.readFileSync(path.join(root, locale + '.json'), 'utf8')\n    );\n    return memo;\n  }, {});\n  const supportedLocales = new Locales(locales);\n\n  return {\n    from: memoize(ctx => {\n      const expectedLocales = new Locales(resolveLocales(ctx));\n      const locale = expectedLocales.best(supportedLocales);\n      const translations: TranslationsObjectType = data[locale.normalized];\n      return {translations, locale};\n    }),\n  };\n};\n\nexport default (((__NODE__ ? loader : null): any): typeof loader);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\nimport querystring from 'querystring';\nimport {Locale} from 'locale';\n\nimport {createPlugin, memoize, html} from 'fusion-core';\nimport type {FusionPlugin} from 'fusion-core';\n\nimport {I18nLoaderToken} from './tokens.js';\nimport createLoader from './loader.js';\nimport type {\n  I18nDepsType,\n  I18nServiceType,\n  TranslationsObjectType,\n} from './types.js';\n\ntype PluginType = FusionPlugin<I18nDepsType, I18nServiceType>;\nconst pluginFactory: () => PluginType = () =>\n  createPlugin({\n    deps: {\n      loader: I18nLoaderToken.optional,\n    },\n    provides: ({loader}) => {\n      class I18n {\n        translations: TranslationsObjectType;\n        locale: string | Locale;\n\n        constructor(ctx) {\n          if (!loader) {\n            loader = createLoader();\n          }\n          const {translations, locale} = loader.from(ctx);\n          // eslint-disable-next-line no-console\n          this.translations = translations;\n          this.locale = locale;\n        }\n        async load() {} //mirror client API\n        translate(key, interpolations = {}) {\n          const template = this.translations[key];\n          return template != null\n            ? template.replace(/\\${(.*?)}/g, (_, k) => interpolations[k])\n            : key;\n        }\n      }\n\n      const service = {from: memoize(ctx => new I18n(ctx))};\n      return service;\n    },\n    middleware: (_, plugin) => {\n      // TODO(#4) refactor: this currently depends on babel plugins in framework's webpack config.\n      // Ideally these babel plugins should be part of this package, not hard-coded in framework core\n      const chunkTranslationMap = require('../chunk-translation-map');\n      return async (ctx, next) => {\n        if (ctx.element) {\n          await next();\n          const i18n = plugin.from(ctx);\n\n          // get the webpack chunks that are used and serialize their translations\n          const chunks: Array<string | number> = [\n            ...ctx.syncChunks,\n            ...ctx.preloadChunks,\n          ];\n          const translations = {};\n          chunks.forEach(id => {\n            const keys = Array.from(\n              chunkTranslationMap.translationsForChunk(id)\n            );\n            keys.forEach(key => {\n              translations[key] = i18n.translations && i18n.translations[key];\n            });\n          });\n          // i18n.locale is actually a locale.Locale instance\n          if (!i18n.locale) {\n            throw new Error('i18n.locale was empty');\n          }\n          const localeCode =\n            typeof i18n.locale === 'string' ? i18n.locale : i18n.locale.code;\n          const serialized = JSON.stringify({chunks, localeCode, translations});\n          const script = html`\n            <script type=\"application/json\" id=\"__TRANSLATIONS__\">\n              ${serialized}\n            </script>\n          `; // consumed by ./browser\n          ctx.template.body.push(script);\n        } else if (ctx.path === '/_translations') {\n          const i18n = plugin.from(ctx);\n          const ids = querystring.parse(ctx.querystring).ids || '';\n          const chunks = ids.split(',').map(id => parseInt(id, 10));\n          const translations = {};\n          chunks.forEach(id => {\n            const keys = [...chunkTranslationMap.translationsForChunk(id)];\n            keys.forEach(key => {\n              translations[key] = i18n.translations && i18n.translations[key];\n            });\n          });\n          ctx.body = translations;\n          return next();\n        } else {\n          return next();\n        }\n      };\n    },\n  });\n\nexport default ((__NODE__ && pluginFactory(): any): PluginType);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport {FetchToken} from 'fusion-tokens';\nimport {createPlugin, unescape, createToken} from 'fusion-core';\nimport type {FusionPlugin, Token} from 'fusion-core';\n\nimport type {\n  I18nDepsType,\n  I18nServiceType,\n  TranslationsObjectType,\n} from './types.js';\n\ntype LoadedTranslationsType = {\n  chunks?: Array<number | string>,\n  localeCode?: string,\n  translations?: TranslationsObjectType,\n};\nfunction loadTranslations(): LoadedTranslationsType {\n  const element = document.getElementById('__TRANSLATIONS__');\n  if (!element) {\n    throw new Error(\n      '[fusion-plugin-i18n] - Could not find a __TRANSLATIONS__ element'\n    );\n  }\n  try {\n    return JSON.parse(unescape(element.textContent));\n  } catch (e) {\n    throw new Error(\n      '[fusion-plugin-i18n] - Error parsing __TRANSLATIONS__ element content'\n    );\n  }\n}\n\ntype HydrationStateType = {\n  chunks: Array<number | string>,\n  localeCode?: string,\n  translations: TranslationsObjectType,\n};\nexport const HydrationStateToken: Token<HydrationStateType> = createToken(\n  'HydrationStateToken'\n);\n\ntype PluginType = FusionPlugin<I18nDepsType, I18nServiceType>;\nconst pluginFactory: () => PluginType = () =>\n  createPlugin({\n    deps: {\n      fetch: FetchToken.optional,\n      hydrationState: HydrationStateToken.optional,\n    },\n    provides: ({fetch = window.fetch, hydrationState} = {}) => {\n      class I18n {\n        loadedChunks: Array<number | string>;\n        localeCode: ?string;\n        translationMap: TranslationsObjectType;\n\n        constructor() {\n          const {chunks, localeCode, translations} =\n            hydrationState || loadTranslations();\n          this.loadedChunks = (chunks: Array<number | string> | void) || [];\n          this.localeCode = localeCode;\n          this.translationMap = translations || {};\n        }\n        async load(chunkIds: Array<number | string>): Promise<void> {\n          const unloaded = chunkIds.filter(id => {\n            return this.loadedChunks.indexOf(id) < 0;\n          });\n          const fetchOpts = {\n            method: 'POST',\n            headers: {\n              Accept: '*/*',\n              ...(this.localeCode\n                ? {'X-Fusion-Locale-Code': this.localeCode}\n                : {}),\n            },\n          };\n          if (unloaded.length > 0) {\n            // Don't try to load translations again if a request is already in\n            // flight. This means that we need to add unloaded chunks to\n            // loadedChunks optimistically and remove them if some error happens\n            this.loadedChunks = [...this.loadedChunks, ...unloaded];\n\n            const ids = unloaded.join(',');\n            // TODO(#3) don't append prefix if injected fetch also injects prefix\n            return fetch(`/_translations?ids=${ids}`, fetchOpts)\n              .then(r => r.json())\n              .then((data: {[string]: string}) => {\n                for (const key in data) this.translationMap[key] = data[key];\n              })\n              .catch((err: Error) => {\n                // An error occurred, so remove the chunks we were trying to load\n                // from loadedChunks. This allows us to try to load those chunk\n                // translations again\n                this.loadedChunks = this.loadedChunks.filter(\n                  chunk => unloaded.indexOf(chunk) === -1\n                );\n                throw err;\n              });\n          }\n        }\n        translate(key: string, interpolations: TranslationsObjectType = {}) {\n          const template = this.translationMap[key];\n          return template\n            ? template.replace(/\\${(.*?)}/g, (_, k) => interpolations[k])\n            : key;\n        }\n      }\n      const i18n = new I18n();\n      return {from: () => i18n};\n    },\n  });\n\nexport default ((__BROWSER__ && pluginFactory(): any): PluginType);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {createToken} from 'fusion-core';\nimport type {FusionPlugin, Token} from 'fusion-core';\n\nimport serverPlugin from './node';\nimport clientPlugin, {HydrationStateToken} from './browser';\nimport createI18nLoader from './loader';\nimport type {I18nDepsType, I18nServiceType} from './types.js';\nimport {I18nLoaderToken} from './tokens.js';\n\nexport type {I18nDepsType, I18nServiceType};\nconst I18nToken: Token<I18nServiceType> = createToken('I18nToken');\n\nconst plugin: FusionPlugin<I18nDepsType, I18nServiceType> = __NODE__\n  ? serverPlugin\n  : clientPlugin;\n\nexport default plugin;\nexport {I18nToken, I18nLoaderToken, HydrationStateToken, createI18nLoader};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\nimport test from 'tape-cup';\n\nimport {getSimulator} from 'fusion-test-utils';\nimport App, {consumeSanitizedHTML} from 'fusion-core';\nimport type {Context} from 'fusion-core';\n\nimport I18n from '../node';\nimport {I18nLoaderToken} from '../tokens.js';\nimport {I18nToken} from '../index';\n\ntest('translate', async t => {\n  const data = {test: 'hello', interpolated: 'hi ${value}'};\n  const app = new App('el', el => el);\n  app.register(I18nToken, I18n);\n  app.register(I18nLoaderToken, {\n    from: () => ({translations: data, locale: 'en_US'}),\n  });\n  app.middleware({i18n: I18nToken}, ({i18n}) => {\n    return (ctx, next) => {\n      const translator = i18n.from(ctx);\n      t.equals(translator.translate('test'), 'hello');\n      t.equals(\n        translator.translate('interpolated', {value: 'world'}),\n        'hi world'\n      );\n      return next();\n    };\n  });\n  const simulator = getSimulator(app);\n  await simulator.render('/');\n  t.end();\n});\n\ntest('ssr', async t => {\n  const data = {test: 'hello</div>', interpolated: 'hi ${value}'};\n\n  /* eslint-disable import/no-unresolved */\n  // $FlowFixMe\n  const chunkTranslationMap = require('../chunk-translation-map'); // relative to ./dist-tests\n  /* eslint-enable import/no-unresolved */\n  chunkTranslationMap.add('a.js', [0], Object.keys(data));\n\n  const ctx: Context = {\n    syncChunks: [0],\n    preloadChunks: [],\n    headers: {'accept-language': 'en-US'},\n    element: 'test',\n    // $FlowFixMe - Invalid context\n    template: {body: []},\n    memoized: new Map(),\n  };\n  const deps = {\n    loader: {from: () => ({translations: data, locale: 'en-US'})},\n  };\n\n  t.plan(3);\n  if (!I18n.provides) {\n    t.end();\n    return;\n  }\n  const i18n = I18n.provides(deps);\n\n  if (!I18n.middleware) {\n    t.end();\n    return;\n  }\n  await I18n.middleware(deps, i18n)(ctx, () => Promise.resolve());\n  t.equals(ctx.template.body.length, 1, 'injects hydration code');\n  t.equals(\n    // $FlowFixMe\n    consumeSanitizedHTML(ctx.template.body[0]).match('hello')[0],\n    'hello'\n  );\n  // $FlowFixMe\n  t.equals(consumeSanitizedHTML(ctx.template.body[0]).match('</div>'), null);\n\n  chunkTranslationMap.dispose('a.js', [0], Object.keys(data));\n  chunkTranslationMap.translations.clear();\n  t.end();\n});\n\ntest('endpoint', async t => {\n  const data = {test: 'hello', interpolated: 'hi ${value}'};\n\n  /* eslint-disable import/no-unresolved */\n  // $FlowFixMe\n  const chunkTranslationMap = require('../chunk-translation-map'); // relative to ./dist-tests\n  /* eslint-enable import/no-unresolved */\n  chunkTranslationMap.add('a.js', [0], Object.keys(data));\n  // $FlowFixMe - Invalid context\n  const ctx: Context = {\n    syncChunks: [],\n    preloadChunks: [],\n    headers: {'accept-language': 'en_US'},\n    path: '/_translations',\n    querystring: 'ids=0',\n    memoized: new Map(),\n    body: '',\n  };\n\n  const deps = {\n    loader: {from: () => ({translations: data, locale: 'en-US'})},\n  };\n\n  t.plan(1);\n  if (!I18n.provides) {\n    t.end();\n    return;\n  }\n  const i18n = I18n.provides(deps);\n\n  if (!I18n.middleware) {\n    t.end();\n    return;\n  }\n  await I18n.middleware(deps, i18n)(ctx, () => Promise.resolve());\n  t.deepEquals(ctx.body, data, 'injects hydration code');\n\n  chunkTranslationMap.dispose('a.js', [0], Object.keys(data));\n  chunkTranslationMap.translations.clear();\n  t.end();\n});\n\ntest('non matched route', async t => {\n  const data = {test: 'hello', interpolated: 'hi ${value}'};\n  // $FlowFixMe - Invalid context\n  const ctx: Context = {\n    path: '/_something',\n    memoized: new Map(),\n    body: '',\n  };\n\n  const deps = {\n    loader: {from: () => ({translations: data, locale: 'en-US'})},\n  };\n\n  t.plan(1);\n  if (!I18n.provides) {\n    t.end();\n    return;\n  }\n  const i18n = I18n.provides(deps);\n\n  if (!I18n.middleware) {\n    t.end();\n    return;\n  }\n  await I18n.middleware(deps, i18n)(ctx, () => Promise.resolve());\n  t.notok(ctx.body, 'does not set ctx.body');\n  t.end();\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\nimport fs from 'fs';\nimport test from 'tape-cup';\n\nimport App from 'fusion-core';\nimport {getSimulator} from 'fusion-test-utils';\n\nimport I18n from '../node';\nimport createLoader from '../loader';\nimport {createI18nLoader, I18nLoaderToken, I18nToken} from '../index.js';\n\ntest('loader', async t => {\n  fs.mkdirSync('translations');\n  fs.writeFileSync('translations/en_US.json', '{\"test\": \"hi ${value}\"}');\n\n  const app = new App('el', el => el);\n  app.register(I18nToken, I18n);\n  app.middleware({i18n: I18nToken}, ({i18n}) => {\n    return (ctx, next) => {\n      const translator = i18n.from(ctx);\n      t.equals(translator.translate('test', {value: 'world'}), 'hi world');\n      return next();\n    };\n  });\n  const simulator = getSimulator(app);\n  await simulator.render('/');\n  fs.unlinkSync('translations/en_US.json');\n  fs.rmdirSync('translations');\n  t.end();\n});\n\ntest('custom locale resolver', async t => {\n  fs.mkdirSync('translations');\n  fs.writeFileSync('translations/en_US.json', '{\"foo\": \"bar\"}');\n  fs.writeFileSync('translations/custom_US.json', '{\"foo\": \"qux\"}');\n\n  const app = new App('el', el => el);\n  app.register(I18nLoaderToken, createI18nLoader(ctx => 'custom_US'));\n  app.register(I18nToken, I18n);\n  app.middleware({i18n: I18nToken}, ({i18n}) => {\n    return (ctx, next) => {\n      const translator = i18n.from(ctx);\n      t.equals(translator.translate('foo'), 'qux');\n      return next();\n    };\n  });\n  const simulator = getSimulator(app);\n  await simulator.render('/', {headers: {'accept-language': 'en_US'}});\n  fs.unlinkSync('translations/en_US.json');\n  fs.unlinkSync('translations/custom_US.json');\n  fs.rmdirSync('translations');\n  t.end();\n});\n\ntest('no translations dir', t => {\n  t.doesNotThrow(createLoader);\n  t.end();\n});\n"],"names":["I18nLoaderToken","createToken","defaultResolveLocales","ctx","headers","loader","resolveLocales","readDir","root","fs","readdirSync","e","locales","filter","p","match","map","replace","data","reduce","memo","locale","parsedLocale","Locale","normalized","JSON","parse","readFileSync","path","join","supportedLocales","Locales","from","memoize","expectedLocales","best","translations","pluginFactory","createPlugin","deps","optional","provides","I18n","constructor","createLoader","load","translate","key","interpolations","template","_","k","service","middleware","plugin","chunkTranslationMap","require","next","element","i18n","chunks","syncChunks","preloadChunks","forEach","id","keys","Array","translationsForChunk","Error","localeCode","code","serialized","stringify","script","html","body","push","ids","querystring","split","parseInt","loadTranslations","document","getElementById","unescape","textContent","HydrationStateToken","fetch","FetchToken","hydrationState","window","loadedChunks","translationMap","chunkIds","unloaded","indexOf","fetchOpts","method","Accept","length","then","r","json","catch","err","chunk","I18nToken","serverPlugin","test","t","interpolated","app","App","el","register","translator","equals","value","simulator","getSimulator","render","end","add","Object","memoized","Map","plan","Promise","resolve","consumeSanitizedHTML","dispose","clear","deepEquals","notok","mkdirSync","writeFileSync","unlinkSync","rmdirSync","createI18nLoader","doesNotThrow"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,AAKO,MAAMA,eAAsC,2BAAGC,eAAW,CAC/D,iBAD+D,CAAd,CAA5C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLP;;AAmBA,MAAMC,qBAAyC,GAAGC,GAAG,IACnD;;;SAAAA,GAAG,CAACC,OAAJ,CAAY,iBAAZ;CADF;;;;AAGA,MAAMC,MAAyB,GAAG,CAACC,cAAc,8BAAGJ,qBAAH,CAAf,KAA4C;;;;QACtEK,OAAO,GAAGC,IAAI,IAAI;;;;QAClB;;aACKC,EAAE,CAACC,WAAH,CAAeF,IAAf,CAAP;KADF,CAEE,OAAOG,CAAP,EAAU;;aACH,EAAP;;GAJJ;;QAOMH,IAAI,2BAAG,gBAAH,CAAV;QACMI,OAAO,2BAAGL,OAAO,CAACC,IAAD,CAAP,CACbK,MADa,CACNC,CAAC,IAAI;;;WAAAA,CAAC,CAACC,KAAF,CAAQ,OAAR;GADC,EAEbC,GAFa,CAETF,CAAC,IAAI;;;WAAAA,CAAC,CAACG,OAAF,CAAU,SAAV,EAAqB,EAArB;GAFI,CAAH,CAAb;QAGMC,IAAI,4BAAGN,OAAO,CAACO,MAAR,CAAe,CAACC,IAAD,EAAOC,SAAP,KAAkB;;UACtCC,YAAY,4BAAG,IAAIC,aAAJ,CAAWF,SAAX,CAAH,CAAlB;;IACAD,IAAI,CAACE,YAAY,CAACE,UAAd,CAAJ,GAAgCC,IAAI,CAACC,KAAL,CAC9BjB,EAAE,CAACkB,YAAH,CAAgBC,IAAI,CAACC,IAAL,CAAUrB,IAAV,EAAgBa,SAAM,GAAG,OAAzB,CAAhB,EAAmD,MAAnD,CAD8B,CAAhC;;WAGOD,IAAP;GALW,EAMV,EANU,CAAH,CAAV;QAOMU,gBAAgB,4BAAG,IAAIC,cAAJ,CAAYnB,OAAZ,CAAH,CAAtB;;SAEO;IACLoB,IAAI,EAAEC,WAAO,CAAC9B,GAAG,IAAI;;YACb+B,eAAe,4BAAG,IAAIH,cAAJ,CAAYzB,cAAc,CAACH,GAAD,CAA1B,CAAH,CAArB;YACMkB,SAAM,4BAAGa,eAAe,CAACC,IAAhB,CAAqBL,gBAArB,CAAH,CAAZ;YACMM,YAAoC,4BAAGlB,IAAI,CAACG,SAAM,CAACG,UAAR,CAAP,CAA1C;;aACO;QAACY,YAAD;gBAAef;OAAtB;KAJW;GADf;CArBF;;AA+BA,8CAA6BhB,MAAX,CAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;;AAeA,MAAMgC,aAA+B,GAAG,MACtC;;;SAAAC,gBAAY,CAAC;IACXC,IAAI,EAAE;MACJlC,MAAM,EAAEL,eAAe,CAACwC;KAFf;IAIXC,QAAQ,EAAE,CAAC;MAACpC;KAAF,KAAc;;;YAChBqC,IAAN,CAAW;QAITC,WAAW,CAACxC,GAAD,EAAM;;;;cACX,CAACE,MAAL,EAAa;;;YACXA,MAAM,GAAGuC,YAAY,EAArB;WADF;;;;gBAGM;YAACR,YAAD;oBAAef;sCAAUhB,MAAM,CAAC2B,IAAP,CAAY7B,GAAZ,CAAzB,CAAN,CAJe;;;eAMViC,YAAL,GAAoBA,YAApB;;eACKf,MAAL,GAAcA,SAAd;;;cAEIwB,IAAN,GAAa;;SAbJ;;;QAcTC,SAAS,CAACC,GAAD,EAAMC,cAAc,8BAAG,EAAH,CAApB,EAA2B;;gBAC5BC,QAAQ,2BAAG,KAAKb,YAAL,CAAkBW,GAAlB,CAAH,CAAd;;iBACOE,QAAQ,IAAI,IAAZ,8BACHA,QAAQ,CAAChC,OAAT,CAAiB,YAAjB,EAA+B,CAACiC,CAAD,EAAIC,CAAJ,KAAU;;;mBAAAH,cAAc,CAACG,CAAD,CAAd;WAAzC,CADG,+BAEHJ,GAFG,CAAP;;;;;YAMEK,OAAO,4BAAG;QAACpB,IAAI,EAAEC,WAAO,CAAC9B,GAAG,IAAI;;;qBAAIuC,IAAJ,CAASvC,GAAT;SAAR;OAAjB,CAAb;;aACOiD,OAAP;KA5BS;IA8BXC,UAAU,EAAE,CAACH,CAAD,EAAII,MAAJ,KAAe;;;;YAGnBC,mBAAmB,4BAAGC,OAAO,CAAC,0BAAD,CAAV,CAAzB;;aACO,OAAOrD,GAAP,EAAYsD,IAAZ,KAAqB;;;;YACtBtD,GAAG,CAACuD,OAAR,EAAiB;;;gBACTD,IAAI,EAAV;gBACME,IAAI,4BAAGL,MAAM,CAACtB,IAAP,CAAY7B,GAAZ,CAAH,CAAV,CAFe;;gBAKTyD,MAA8B,4BAAG,CACrC,GAAGzD,GAAG,CAAC0D,UAD8B,EAErC,GAAG1D,GAAG,CAAC2D,aAF8B,CAAH,CAApC;gBAIM1B,YAAY,4BAAG,EAAH,CAAlB;;UACAwB,MAAM,CAACG,OAAP,CAAeC,EAAE,IAAI;;kBACbC,IAAI,4BAAGC,KAAK,CAAClC,IAAN,CACXuB,mBAAmB,CAACY,oBAApB,CAAyCH,EAAzC,CADW,CAAH,CAAV;;YAGAC,IAAI,CAACF,OAAL,CAAahB,GAAG,IAAI;;;cAClBX,YAAY,CAACW,GAAD,CAAZ,GAAoB,2BAAAY,IAAI,CAACvB,YAAL,gCAAqBuB,IAAI,CAACvB,YAAL,CAAkBW,GAAlB,CAArB,CAApB;aADF;WAJF,EAVe;;;;cAmBX,CAACY,IAAI,CAACtC,MAAV,EAAkB;;;kBACV,IAAI+C,KAAJ,CAAU,uBAAV,CAAN;WADF;;;;gBAGMC,UAAU,4BACd,OAAOV,IAAI,CAACtC,MAAZ,KAAuB,QAAvB,8BAAkCsC,IAAI,CAACtC,MAAvC,+BAAgDsC,IAAI,CAACtC,MAAL,CAAYiD,IAA5D,CADc,CAAhB;gBAEMC,UAAU,4BAAG9C,IAAI,CAAC+C,SAAL,CAAe;YAACZ,MAAD;YAASS,UAAT;YAAqBjC;WAApC,CAAH,CAAhB;gBACMqC,MAAM,4BAAGC,QAAK;;gBAEdH,UAAW;;WAFL,CAAZ,CAzBe;;;UA8BfpE,GAAG,CAAC8C,QAAJ,CAAa0B,IAAb,CAAkBC,IAAlB,CAAuBH,MAAvB;SA9BF,MA+BO;;;;cAAItE,GAAG,CAACyB,IAAJ,KAAa,gBAAjB,EAAmC;;kBAClC+B,IAAI,4BAAGL,MAAM,CAACtB,IAAP,CAAY7B,GAAZ,CAAH,CAAV;kBACM0E,GAAG,4BAAG,2BAAAC,WAAW,CAACpD,KAAZ,CAAkBvB,GAAG,CAAC2E,WAAtB,EAAmCD,GAAnC,gCAA0C,EAA1C,CAAH,CAAT;kBACMjB,MAAM,4BAAGiB,GAAG,CAACE,KAAJ,CAAU,GAAV,EAAe/D,GAAf,CAAmBgD,EAAE,IAAI;;;qBAAAgB,QAAQ,CAAChB,EAAD,EAAK,EAAL,CAAR;aAAzB,CAAH,CAAZ;kBACM5B,YAAY,4BAAG,EAAH,CAAlB;;YACAwB,MAAM,CAACG,OAAP,CAAeC,EAAE,IAAI;;oBACbC,IAAI,4BAAG,CAAC,GAAGV,mBAAmB,CAACY,oBAApB,CAAyCH,EAAzC,CAAJ,CAAH,CAAV;;cACAC,IAAI,CAACF,OAAL,CAAahB,GAAG,IAAI;;;gBAClBX,YAAY,CAACW,GAAD,CAAZ,GAAoB,2BAAAY,IAAI,CAACvB,YAAL,gCAAqBuB,IAAI,CAACvB,YAAL,CAAkBW,GAAlB,CAArB,CAApB;eADF;aAFF;;YAMA5C,GAAG,CAACwE,IAAJ,GAAWvC,YAAX;;mBACOqB,IAAI,EAAX;WAZK,MAaA;;;mBACEA,IAAI,EAAX;;;OA9CJ;;GAlCQ,CAAZ;CADF;;AAuFA,WAAiB,iEAAYpB,aAAa,EAAzB,CAAjB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvGA,AAeA,SAAS4C,gBAAT,GAAoD;;QAC5CvB,OAAO,2BAAGwB,QAAQ,CAACC,cAAT,CAAwB,kBAAxB,CAAH,CAAb;;;MACI,CAACzB,OAAL,EAAc;;;UACN,IAAIU,KAAJ,CACJ,kEADI,CAAN;GADF;;;;;;MAKI;;WACK3C,IAAI,CAACC,KAAL,CAAW0D,YAAQ,CAAC1B,OAAO,CAAC2B,WAAT,CAAnB,CAAP;GADF,CAEE,OAAO1E,CAAP,EAAU;;UACJ,IAAIyD,KAAJ,CACJ,uEADI,CAAN;;;;AAWJ,AAAO,MAAMkB,mBAA8C,2BAAGrF,eAAW,CACvE,qBADuE,CAAd,CAApD;;;AAKP,MAAMoC,eAA+B,GAAG,MACtC;;;SAAAC,gBAAY,CAAC;IACXC,IAAI,EAAE;MACJgD,KAAK,EAAEC,uBAAU,CAAChD,QADd;MAEJiD,cAAc,EAAEH,mBAAmB,CAAC9C;KAH3B;IAKXC,QAAQ,EAAE,CAAC;MAAC8C,KAAK,8BAAGG,MAAM,CAACH,KAAV,CAAN;MAAuBE;mCAAkB,EAAzC,CAAD,KAAiD;;;YACnD/C,IAAN,CAAW;QAKTC,WAAW,GAAG;;gBACN;YAACiB,MAAD;YAASS,UAAT;YAAqBjC;sCACzB,2BAAAqD,cAAc,gCAAIR,gBAAgB,EAApB,CADV,CAAN;;eAEKU,YAAL,GAAoB,2BAAC/B,MAAD,gCAA2C,EAA3C,CAApB;;eACKS,UAAL,GAAkBA,UAAlB;;eACKuB,cAAL,GAAsB,2BAAAxD,YAAY,gCAAI,EAAJ,CAAlC;;;cAEIS,IAAN,CAAWgD,QAAX,EAA4D;;gBACpDC,QAAQ,4BAAGD,QAAQ,CAAChF,MAAT,CAAgBmD,EAAE,IAAI;;;mBAC9B,KAAK2B,YAAL,CAAkBI,OAAlB,CAA0B/B,EAA1B,IAAgC,CAAvC;WADe,CAAH,CAAd;gBAGMgC,SAAS,4BAAG;YAChBC,MAAM,EAAE,MADQ;YAEhB7F,OAAO;cACL8F,MAAM,EAAE;eACJ,KAAK7B,UAAL,8BACA;sCAAyB,KAAKA;aAD9B,+BAEA,EAFA,CAFC;WAFM,CAAf;;;cASIyB,QAAQ,CAACK,MAAT,GAAkB,CAAtB,EAAyB;;;;;;iBAIlBR,YAAL,GAAoB,CAAC,GAAG,KAAKA,YAAT,EAAuB,GAAGG,QAA1B,CAApB;kBAEMjB,GAAG,4BAAGiB,QAAQ,CAACjE,IAAT,CAAc,GAAd,CAAH,CAAT,CANuB;;;mBAQhB0D,KAAK,CAAE,sBAAqBV,GAAI,EAA3B,EAA8BmB,SAA9B,CAAL,CACJI,IADI,CACCC,CAAC,IAAI;;;qBAAAA,CAAC,CAACC,IAAF;aADN,EAEJF,IAFI,CAEElF,IAAD,IAA8B;;;;mBAC7B,MAAM6B,GAAX,IAAkB7B,IAAlB,EAAwB;;qBAAK0E,cAAL,CAAoB7C,GAApB,IAA2B7B,IAAI,CAAC6B,GAAD,CAA/B;;aAHrB,EAKJwD,KALI,CAKGC,GAAD,IAAgB;;;;;;mBAIhBb,YAAL,GAAoB,KAAKA,YAAL,CAAkB9E,MAAlB,CAClB4F,KAAK,IAAI;;;uBAAAX,QAAQ,CAACC,OAAT,CAAiBU,KAAjB,MAA4B,CAAC,CAA7B;eADS,CAApB;;oBAGMD,GAAN;aAZG,CAAP;WARF;;;;;QAwBF1D,SAAS,CAACC,GAAD,EAAcC,cAAsC,8BAAG,EAAH,CAApD,EAA2D;;gBAC5DC,QAAQ,4BAAG,KAAK2C,cAAL,CAAoB7C,GAApB,CAAH,CAAd;;iBACOE,QAAQ,8BACXA,QAAQ,CAAChC,OAAT,CAAiB,YAAjB,EAA+B,CAACiC,CAAD,EAAIC,CAAJ,KAAU;;;mBAAAH,cAAc,CAACG,CAAD,CAAd;WAAzC,CADW,+BAEXJ,GAFW,CAAf;;;;;YAKEY,IAAI,4BAAG,IAAIjB,IAAJ,EAAH,CAAV;;aACO;QAACV,IAAI,EAAE,MAAM2B;;;iBAAAA,IAAI;;OAAxB;;GA/DQ,CAAZ;CADF;;AAoEA,AAAiB,kEAAetB,eAAa,EAA5B,CAAjB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GA,AAUA,MAAMqE,SAAiC,0BAAGzG,eAAW,CAAC,WAAD,CAAd,CAAvC;AAEA,MAAMqD,MAAmD,oDACrDqD,KADqD,CAAzD;;ACpBA;;;;;;;;;AAUA,AAUAC,IAAI,CAAC,WAAD,EAAc,MAAMC,CAAN,IAAW;QACrB3F,IAAI,GAAG;IAAC0F,IAAI,EAAE,OAAP;IAAgBE,YAAY,EAAE;GAA3C;QACMC,GAAG,GAAG,IAAIC,YAAJ,CAAQ,IAAR,EAAcC,EAAE,IAAIA,EAApB,CAAZ;EACAF,GAAG,CAACG,QAAJ,CAAaR,SAAb,EAAwBhE,IAAxB;EACAqE,GAAG,CAACG,QAAJ,CAAalH,eAAb,EAA8B;IAC5BgC,IAAI,EAAE,OAAO;MAACI,YAAY,EAAElB,IAAf;MAAqBG,MAAM,EAAE;KAApC;GADR;EAGA0F,GAAG,CAAC1D,UAAJ,CAAe;IAACM,IAAI,EAAE+C;GAAtB,EAAkC,CAAC;IAAC/C;GAAF,KAAY;WACrC,CAACxD,GAAD,EAAMsD,IAAN,KAAe;YACd0D,UAAU,GAAGxD,IAAI,CAAC3B,IAAL,CAAU7B,GAAV,CAAnB;MACA0G,CAAC,CAACO,MAAF,CAASD,UAAU,CAACrE,SAAX,CAAqB,MAArB,CAAT,EAAuC,OAAvC;MACA+D,CAAC,CAACO,MAAF,CACED,UAAU,CAACrE,SAAX,CAAqB,cAArB,EAAqC;QAACuE,KAAK,EAAE;OAA7C,CADF,EAEE,UAFF;aAIO5D,IAAI,EAAX;KAPF;GADF;QAWM6D,SAAS,GAAGC,4BAAY,CAACR,GAAD,CAA9B;QACMO,SAAS,CAACE,MAAV,CAAiB,GAAjB,CAAN;EACAX,CAAC,CAACY,GAAF;CApBE,CAAJ;AAuBAb,IAAI,CAAC,KAAD,EAAQ,MAAMC,CAAN,IAAW;QACf3F,IAAI,GAAG;IAAC0F,IAAI,EAAE,aAAP;IAAsBE,YAAY,EAAE;GAAjD;;;;QAIMvD,mBAAmB,GAAGC,OAAO,CAAC,0BAAD,CAAnC,CALqB;;;;;EAOrBD,mBAAmB,CAACmE,GAApB,CAAwB,MAAxB,EAAgC,CAAC,CAAD,CAAhC,EAAqCC,MAAM,CAAC1D,IAAP,CAAY/C,IAAZ,CAArC;QAEMf,GAAY,GAAG;IACnB0D,UAAU,EAAE,CAAC,CAAD,CADO;IAEnBC,aAAa,EAAE,EAFI;IAGnB1D,OAAO,EAAE;yBAAoB;KAHV;IAInBsD,OAAO,EAAE,MAJU;;IAMnBT,QAAQ,EAAE;MAAC0B,IAAI,EAAE;KANE;IAOnBiD,QAAQ,EAAE,IAAIC,GAAJ;GAPZ;QASMtF,IAAI,GAAG;IACXlC,MAAM,EAAE;MAAC2B,IAAI,EAAE,OAAO;QAACI,YAAY,EAAElB,IAAf;QAAqBG,MAAM,EAAE;OAApC;;GADjB;EAIAwF,CAAC,CAACiB,IAAF,CAAO,CAAP;;MACI,CAACpF,IAAI,CAACD,QAAV,EAAoB;IAClBoE,CAAC,CAACY,GAAF;;;;QAGI9D,IAAI,GAAGjB,IAAI,CAACD,QAAL,CAAcF,IAAd,CAAb;;MAEI,CAACG,IAAI,CAACW,UAAV,EAAsB;IACpBwD,CAAC,CAACY,GAAF;;;;QAGI/E,IAAI,CAACW,UAAL,CAAgBd,IAAhB,EAAsBoB,IAAtB,EAA4BxD,GAA5B,EAAiC,MAAM4H,OAAO,CAACC,OAAR,EAAvC,CAAN;EACAnB,CAAC,CAACO,MAAF,CAASjH,GAAG,CAAC8C,QAAJ,CAAa0B,IAAb,CAAkBwB,MAA3B,EAAmC,CAAnC,EAAsC,wBAAtC;EACAU,CAAC,CAACO,MAAF;EAEEa,wBAAoB,CAAC9H,GAAG,CAAC8C,QAAJ,CAAa0B,IAAb,CAAkB,CAAlB,CAAD,CAApB,CAA2C5D,KAA3C,CAAiD,OAAjD,EAA0D,CAA1D,CAFF,EAGE,OAHF,EAnCqB;;EAyCrB8F,CAAC,CAACO,MAAF,CAASa,wBAAoB,CAAC9H,GAAG,CAAC8C,QAAJ,CAAa0B,IAAb,CAAkB,CAAlB,CAAD,CAApB,CAA2C5D,KAA3C,CAAiD,QAAjD,CAAT,EAAqE,IAArE;EAEAwC,mBAAmB,CAAC2E,OAApB,CAA4B,MAA5B,EAAoC,CAAC,CAAD,CAApC,EAAyCP,MAAM,CAAC1D,IAAP,CAAY/C,IAAZ,CAAzC;EACAqC,mBAAmB,CAACnB,YAApB,CAAiC+F,KAAjC;EACAtB,CAAC,CAACY,GAAF;CA7CE,CAAJ;AAgDAb,IAAI,CAAC,UAAD,EAAa,MAAMC,CAAN,IAAW;QACpB3F,IAAI,GAAG;IAAC0F,IAAI,EAAE,OAAP;IAAgBE,YAAY,EAAE;GAA3C;;;;QAIMvD,mBAAmB,GAAGC,OAAO,CAAC,0BAAD,CAAnC,CAL0B;;;;;EAO1BD,mBAAmB,CAACmE,GAApB,CAAwB,MAAxB,EAAgC,CAAC,CAAD,CAAhC,EAAqCC,MAAM,CAAC1D,IAAP,CAAY/C,IAAZ,CAArC,EAP0B;;QASpBf,GAAY,GAAG;IACnB0D,UAAU,EAAE,EADO;IAEnBC,aAAa,EAAE,EAFI;IAGnB1D,OAAO,EAAE;yBAAoB;KAHV;IAInBwB,IAAI,EAAE,gBAJa;IAKnBkD,WAAW,EAAE,OALM;IAMnB8C,QAAQ,EAAE,IAAIC,GAAJ,EANS;IAOnBlD,IAAI,EAAE;GAPR;QAUMpC,IAAI,GAAG;IACXlC,MAAM,EAAE;MAAC2B,IAAI,EAAE,OAAO;QAACI,YAAY,EAAElB,IAAf;QAAqBG,MAAM,EAAE;OAApC;;GADjB;EAIAwF,CAAC,CAACiB,IAAF,CAAO,CAAP;;MACI,CAACpF,IAAI,CAACD,QAAV,EAAoB;IAClBoE,CAAC,CAACY,GAAF;;;;QAGI9D,IAAI,GAAGjB,IAAI,CAACD,QAAL,CAAcF,IAAd,CAAb;;MAEI,CAACG,IAAI,CAACW,UAAV,EAAsB;IACpBwD,CAAC,CAACY,GAAF;;;;QAGI/E,IAAI,CAACW,UAAL,CAAgBd,IAAhB,EAAsBoB,IAAtB,EAA4BxD,GAA5B,EAAiC,MAAM4H,OAAO,CAACC,OAAR,EAAvC,CAAN;EACAnB,CAAC,CAACuB,UAAF,CAAajI,GAAG,CAACwE,IAAjB,EAAuBzD,IAAvB,EAA6B,wBAA7B;EAEAqC,mBAAmB,CAAC2E,OAApB,CAA4B,MAA5B,EAAoC,CAAC,CAAD,CAApC,EAAyCP,MAAM,CAAC1D,IAAP,CAAY/C,IAAZ,CAAzC;EACAqC,mBAAmB,CAACnB,YAApB,CAAiC+F,KAAjC;EACAtB,CAAC,CAACY,GAAF;CAvCE,CAAJ;AA0CAb,IAAI,CAAC,mBAAD,EAAsB,MAAMC,CAAN,IAAW;QAC7B3F,IAAI,GAAG;IAAC0F,IAAI,EAAE,OAAP;IAAgBE,YAAY,EAAE;GAA3C,CADmC;;QAG7B3G,GAAY,GAAG;IACnByB,IAAI,EAAE,aADa;IAEnBgG,QAAQ,EAAE,IAAIC,GAAJ,EAFS;IAGnBlD,IAAI,EAAE;GAHR;QAMMpC,IAAI,GAAG;IACXlC,MAAM,EAAE;MAAC2B,IAAI,EAAE,OAAO;QAACI,YAAY,EAAElB,IAAf;QAAqBG,MAAM,EAAE;OAApC;;GADjB;EAIAwF,CAAC,CAACiB,IAAF,CAAO,CAAP;;MACI,CAACpF,IAAI,CAACD,QAAV,EAAoB;IAClBoE,CAAC,CAACY,GAAF;;;;QAGI9D,IAAI,GAAGjB,IAAI,CAACD,QAAL,CAAcF,IAAd,CAAb;;MAEI,CAACG,IAAI,CAACW,UAAV,EAAsB;IACpBwD,CAAC,CAACY,GAAF;;;;QAGI/E,IAAI,CAACW,UAAL,CAAgBd,IAAhB,EAAsBoB,IAAtB,EAA4BxD,GAA5B,EAAiC,MAAM4H,OAAO,CAACC,OAAR,EAAvC,CAAN;EACAnB,CAAC,CAACwB,KAAF,CAAQlI,GAAG,CAACwE,IAAZ,EAAkB,uBAAlB;EACAkC,CAAC,CAACY,GAAF;CA1BE,CAAJ;;ACrIA;;;;;;;;;AAUA,AAUAb,IAAI,CAAC,QAAD,EAAW,MAAMC,CAAN,IAAW;EACxBpG,EAAE,CAAC6H,SAAH,CAAa,cAAb;EACA7H,EAAE,CAAC8H,aAAH,CAAiB,yBAAjB,EAA4C,yBAA5C;QAEMxB,GAAG,GAAG,IAAIC,YAAJ,CAAQ,IAAR,EAAcC,EAAE,IAAIA,EAApB,CAAZ;EACAF,GAAG,CAACG,QAAJ,CAAaR,SAAb,EAAwBhE,IAAxB;EACAqE,GAAG,CAAC1D,UAAJ,CAAe;IAACM,IAAI,EAAE+C;GAAtB,EAAkC,CAAC;IAAC/C;GAAF,KAAY;WACrC,CAACxD,GAAD,EAAMsD,IAAN,KAAe;YACd0D,UAAU,GAAGxD,IAAI,CAAC3B,IAAL,CAAU7B,GAAV,CAAnB;MACA0G,CAAC,CAACO,MAAF,CAASD,UAAU,CAACrE,SAAX,CAAqB,MAArB,EAA6B;QAACuE,KAAK,EAAE;OAArC,CAAT,EAAyD,UAAzD;aACO5D,IAAI,EAAX;KAHF;GADF;QAOM6D,SAAS,GAAGC,4BAAY,CAACR,GAAD,CAA9B;QACMO,SAAS,CAACE,MAAV,CAAiB,GAAjB,CAAN;EACA/G,EAAE,CAAC+H,UAAH,CAAc,yBAAd;EACA/H,EAAE,CAACgI,SAAH,CAAa,cAAb;EACA5B,CAAC,CAACY,GAAF;CAjBE,CAAJ;AAoBAb,IAAI,CAAC,wBAAD,EAA2B,MAAMC,CAAN,IAAW;EACxCpG,EAAE,CAAC6H,SAAH,CAAa,cAAb;EACA7H,EAAE,CAAC8H,aAAH,CAAiB,yBAAjB,EAA4C,gBAA5C;EACA9H,EAAE,CAAC8H,aAAH,CAAiB,6BAAjB,EAAgD,gBAAhD;QAEMxB,GAAG,GAAG,IAAIC,YAAJ,CAAQ,IAAR,EAAcC,EAAE,IAAIA,EAApB,CAAZ;EACAF,GAAG,CAACG,QAAJ,CAAalH,eAAb,EAA8B0I,YAAgB,CAACvI,GAAG,IAAI,WAAR,CAA9C;EACA4G,GAAG,CAACG,QAAJ,CAAaR,SAAb,EAAwBhE,IAAxB;EACAqE,GAAG,CAAC1D,UAAJ,CAAe;IAACM,IAAI,EAAE+C;GAAtB,EAAkC,CAAC;IAAC/C;GAAF,KAAY;WACrC,CAACxD,GAAD,EAAMsD,IAAN,KAAe;YACd0D,UAAU,GAAGxD,IAAI,CAAC3B,IAAL,CAAU7B,GAAV,CAAnB;MACA0G,CAAC,CAACO,MAAF,CAASD,UAAU,CAACrE,SAAX,CAAqB,KAArB,CAAT,EAAsC,KAAtC;aACOW,IAAI,EAAX;KAHF;GADF;QAOM6D,SAAS,GAAGC,4BAAY,CAACR,GAAD,CAA9B;QACMO,SAAS,CAACE,MAAV,CAAiB,GAAjB,EAAsB;IAACpH,OAAO,EAAE;yBAAoB;;GAApD,CAAN;EACAK,EAAE,CAAC+H,UAAH,CAAc,yBAAd;EACA/H,EAAE,CAAC+H,UAAH,CAAc,6BAAd;EACA/H,EAAE,CAACgI,SAAH,CAAa,cAAb;EACA5B,CAAC,CAACY,GAAF;CApBE,CAAJ;AAuBAb,IAAI,CAAC,qBAAD,EAAwBC,CAAC,IAAI;EAC/BA,CAAC,CAAC8B,YAAF,CAAe/F,YAAf;EACAiE,CAAC,CAACY,GAAF;CAFE,CAAJ"}
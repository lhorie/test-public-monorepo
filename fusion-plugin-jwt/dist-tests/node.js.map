{"version":3,"file":"node.js","sources":["../src/tokens.js","../src/jwt-server.js","../src/index.js","../src/__tests__/flow.node.js","../src/__tests__/interface.node.js","../src/__tests__/test.node.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Token} from 'fusion-core';\nimport {createToken} from 'fusion-core';\n\nexport const SessionSecretToken: Token<string> = createToken('SessionSecret');\nexport const SessionCookieNameToken: Token<string> = createToken(\n  'SessionCookieName'\n);\nexport const SessionCookieExpiresToken: Token<number> = createToken(\n  'SessionCookieExpires'\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport assert from 'assert';\nimport {promisify} from 'util';\nimport jwt from 'jsonwebtoken';\nimport get from 'just-safe-get';\nimport set from 'just-safe-set';\n\nimport {createPlugin, memoize} from 'fusion-core';\nimport type {Context, FusionPlugin} from 'fusion-core';\nimport type {Session} from 'fusion-tokens';\n\nimport {\n  SessionSecretToken,\n  SessionCookieNameToken,\n  SessionCookieExpiresToken,\n} from './tokens.js';\nimport type {SessionDeps, SessionService} from './types.js';\n\n// Scope path to `data.` here since `jsonwebtoken` has some special top-level keys that we do not want to expose (ex: `exp`)\nconst getFullPath = keyPath => `data.${keyPath}`;\n\ntype JWTConfig = {\n  secret: string,\n  cookieName: string,\n  expires: number,\n};\n\nclass JWTSession {\n  cookie: string | void;\n  token: ?Object | string;\n  config: JWTConfig;\n\n  constructor(ctx: Context, config: JWTConfig) {\n    this.config = config;\n    this.cookie = ctx.cookies.get(this.config.cookieName);\n    this.token = null;\n  }\n  async loadToken() {\n    if (this.token == null) {\n      const verify = promisify(jwt.verify.bind(jwt));\n      this.token = this.cookie\n        ? await verify(this.cookie, this.config.secret).catch(() => ({}))\n        : {};\n    }\n    return this.token;\n  }\n  get(keyPath: string): mixed {\n    assert(\n      this.token,\n      \"Cannot access token before loaded, please use this plugin before any of it's dependencies\"\n    );\n    return get(this.token, getFullPath(keyPath));\n  }\n  set(keyPath: string, val: mixed): boolean {\n    assert(\n      this.token,\n      \"Cannot access token before loaded, please use this plugin before any of it's dependencies\"\n    );\n    return set(this.token, getFullPath(keyPath), val);\n  }\n}\n\nconst p: FusionPlugin<SessionDeps, SessionService> =\n  // $FlowFixMe\n  __NODE__ &&\n  createPlugin({\n    deps: {\n      secret: SessionSecretToken,\n      cookieName: SessionCookieNameToken,\n      expires: SessionCookieExpiresToken.optional,\n    },\n    provides: deps => {\n      const {secret, cookieName, expires = 86400} = deps;\n      const service: SessionService = {\n        from: memoize((ctx: Context) => {\n          return new JWTSession(ctx, {secret, cookieName, expires});\n        }),\n      };\n      return service;\n    },\n    middleware: (deps, service) => {\n      const {secret, cookieName, expires = 86400} = deps;\n      return async function jwtMiddleware(\n        ctx: Context,\n        next: () => Promise<void>\n      ) {\n        const sign = promisify(jwt.sign.bind(jwt));\n        const session = service.from(ctx);\n        const token = await session.loadToken();\n        await next();\n        if (token) {\n          // $FlowFixMe\n          delete token.exp; // Clear previous exp time and instead use `expiresIn` option below\n          const time = Date.now(); // get time *before* async signing\n          const signed = await sign(token, secret, {\n            expiresIn: expires,\n          });\n          if (signed !== session.cookie) {\n            const msExpires = new Date(time + expires * 1000);\n            // TODO(#3) provide way to not set cookie if not needed yet\n            ctx.cookies.set(cookieName, signed, {expires: msExpires});\n          }\n        }\n      };\n    },\n  });\n\nexport default ((p: any): FusionPlugin<SessionDeps, Session>);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// Main export file\nimport browser from './jwt-browser';\nimport server from './jwt-server';\n\nimport {\n  SessionCookieExpiresToken,\n  SessionCookieNameToken,\n  SessionSecretToken,\n} from './tokens';\n\nexport default (__BROWSER__ ? browser : server);\n\nexport {SessionCookieExpiresToken, SessionCookieNameToken, SessionSecretToken};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport tape from 'tape-cup';\nimport App from 'fusion-core';\nimport {SessionToken} from 'fusion-tokens';\nimport JWTServer from '../index';\n\ntape('registers against session token', t => {\n  const app = new App('fake-element', el => el);\n  app.register(SessionToken, JWTServer);\n  t.end();\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport test from 'tape-cup';\nimport Plugin, {\n  SessionCookieExpiresToken,\n  SessionCookieNameToken,\n  SessionSecretToken,\n} from '../index';\n\ntest('interface', t => {\n  t.ok(Plugin, 'exports a default plugin');\n  t.ok(SessionCookieExpiresToken, 'exports SessionCookieExpiresToken');\n  t.ok(SessionCookieNameToken, 'exports SessionCookieNameToken');\n  t.ok(SessionSecretToken, 'exports SessionSecretToken');\n  t.end();\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport tape from 'tape-cup';\nimport App, {createToken} from 'fusion-core';\nimport type {Token} from 'fusion-core';\nimport {createServer} from 'http';\nimport fetch from 'node-fetch';\nimport type {Session} from 'fusion-tokens';\n\nimport JWTServer, {\n  SessionSecretToken,\n  SessionCookieNameToken,\n  SessionCookieExpiresToken,\n} from '../index';\n\nconst JWTToken: Token<Session> = createToken('Session');\n\ntape('JWTServer', async t => {\n  const app = new App('fake-element', el => el);\n  app.register(SessionSecretToken, 'session-secret');\n  app.register(SessionCookieNameToken, 'cookie-name');\n  app.register(SessionCookieExpiresToken, 86300);\n  app.register(JWTToken, JWTServer);\n  let count = 0;\n  app.middleware({Session: JWTToken}, ({Session}) => (ctx, next) => {\n    count++;\n    const session = Session.from(ctx);\n    if (count === 2) {\n      t.equal(session.get('test-something'), 'test-value');\n    }\n    session.set('test-something', 'test-value');\n    ctx.body = 'OK';\n    return next();\n  });\n  const cb = app.callback();\n  // $FlowFixMe\n  const server = createServer(cb);\n  await new Promise(resolve => server.listen(3000, resolve));\n  let res = await fetch('http://localhost:3000/');\n  t.ok(res.headers.get('set-cookie'), 'generates a session');\n  t.equal(res.status, 200);\n  res = await fetch('http://localhost:3000/', {\n    headers: {\n      Cookie: res.headers.get('set-cookie'),\n    },\n  });\n  t.equal(res.status, 200);\n  server.close();\n  t.end();\n});\n\ntape('JWTServer with expired token', async t => {\n  const app = new App('fake-element', el => el);\n  app.register(SessionSecretToken, 'session-secret');\n  app.register(SessionCookieNameToken, 'cookie-name');\n  app.register(SessionCookieExpiresToken, 1);\n  app.register(JWTToken, JWTServer);\n\n  let count = 0;\n  app.middleware({Session: JWTToken}, ({Session}) => (ctx, next) => {\n    count++;\n    const session = Session.from(ctx);\n    if (count === 2) {\n      t.notok(\n        session.get('test-something'),\n        'does not set the session if it has expired'\n      );\n    }\n    session.set('test-something', 'test-value');\n    ctx.body = 'OK';\n    return next();\n  });\n\n  const cb = app.callback();\n  // $FlowFixMe\n  const server = createServer(cb);\n  await new Promise(resolve => server.listen(3000, resolve));\n  let res = await fetch('http://localhost:3000/');\n  t.ok(res.headers.get('set-cookie'), 'generates a session');\n  t.equal(res.status, 200);\n\n  await new Promise(resolve => setTimeout(resolve, 2000));\n\n  res = await fetch('http://localhost:3000/', {\n    headers: {\n      Cookie: res.headers.get('set-cookie'),\n    },\n  });\n  t.equal(res.status, 200);\n  server.close();\n  t.end();\n});\n"],"names":["SessionSecretToken","createToken","SessionCookieNameToken","SessionCookieExpiresToken","getFullPath","keyPath","JWTSession","constructor","ctx","config","cookie","cookies","get","cookieName","token","loadToken","verify","promisify","jwt","bind","secret","catch","assert","set","val","p","createPlugin","deps","expires","optional","provides","service","from","memoize","middleware","jwtMiddleware","next","sign","session","exp","time","Date","now","signed","expiresIn","msExpires","server","tape","t","app","App","el","register","SessionToken","JWTServer","end","test","ok","Plugin","JWTToken","count","Session","equal","body","cb","callback","createServer","Promise","resolve","listen","res","fetch","headers","status","Cookie","close","notok","setTimeout"],"mappings":"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"}